<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>B-01 · Registro de usuario · Al Sahara</title>
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body class="bg-light">
  <!-- Navbar simple -->
  <nav class="navbar navbar-dark bg-dark">
    <div class="container">
      <a class="navbar-brand fw-bold" href="index.html">Al Sahara</a>
    </div>
  </nav>

  <main class="container py-5" style="max-width:640px">
    <h1 class="h4 mb-3">Crear cuenta</h1>

    <!-- Mensajes -->
    <div id="reg-msg" class="alert d-none" role="alert"></div>

    <!-- FORM REGISTRO (ids/names necesarios para JS) -->
    <form id="form-register" class="card p-4 shadow-sm bg-white">
      <div class="mb-3">
        <label class="form-label" for="email">Email</label>
        <input name="email" id="email" type="email" class="form-control" placeholder="ana@example.com" required />
      </div>

      <div class="row g-3">
        <div class="col-12 col-md-6">
          <label class="form-label" for="password">Contraseña</label>
          <input name="password" id="password" type="password" class="form-control" required />
          <div class="form-text">Mínimo 8, 1 mayúscula y 1 dígito.</div>
        </div>
        <div class="col-12 col-md-6">
          <label class="form-label" for="password2">Repetir contraseña</label>
          <input name="password2" id="password2" type="password" class="form-control" required />
        </div>
      </div>

      <button class="btn btn-primary mt-4 w-100">Registrarme</button>

      <div class="text-center mt-3">
        <a href="login.html" class="small">¿Ya tienes cuenta? Inicia sesión</a>
      </div>
    </form>
  </main>

  
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- LÓGICA: validaciones y flujo (sin dependencias externas) -->
  <script>
    (function () {
      const API_REGISTER = "http://127.0.0.1:3000/api/auth/register/";
  
      const form = document.getElementById("form-register");
      const msg  = document.getElementById("reg-msg");
  
      function show(type, text) {
        msg.className = "alert alert-" + type;
        msg.textContent = text;
        msg.classList.remove("d-none");
      }
      function hideMsg() {
        msg.classList.add("d-none");
      }
  
      function validEmail(v) {
        return /\S+@\S+\.\S+/.test(v);
      }
  
      function validPass(v) {
        // 8+ caracteres, al menos 1 mayúscula y 1 dígito
        return v.length >= 8 && /[A-Z]/.test(v) && /[0-9]/.test(v);
      }
  
      form.addEventListener("submit", async function (e) {
  e.preventDefault();

  const email = form.email.value.trim();
  const pass  = form.password.value.trim();
  const pass2 = form.password2.value.trim();

  if (!validEmail(email)) {
    show("warning", "Email inválido.");
    return;
  }
  if (!validPass(pass)) {
    show("warning", "La contraseña debe tener 8+ caracteres, 1 mayúscula y 1 dígito.");
    return;
  }
  if (pass !== pass2) {
    show("warning", "Las contraseñas no coinciden.");
    return;
  }

  try {
    const res = await fetch("http://127.0.0.1:3000/api/auth/register/", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({
    email: email,
    password: pass
  })
});

    const data = await res.json();

    if (!res.ok) {
      show("warning", data.message || "No se pudo registrar.");
      return;
    }

    show("success", "Registro exitoso. Redirigiendo…");
    setTimeout(() => location.href = "login.html", 900);

  } catch (err) {
    show("danger", "Error al conectar con el servidor.");
  }
});
    })();
  </script>
</body>
</html>